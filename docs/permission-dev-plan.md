# 权限控制详细开发计划

## 里程碑 M1：数据模型与基础能力（已完成）
- [x] Prisma 扩展全局角色枚举与项目成员关系模型。
- [x] 新增 `AccessService`，统一计算可访问项目范围。
- [x] 各业务模块（项目/需求/成本/进度/工时/通知/审计/AI）接入访问范围过滤与写入校验。
- [x] ReAct 工具调用接入访问范围与模糊匹配。

## 里程碑 M2：管理平台逻辑分离（已完成）
- [x] 前端增加用户平台/管理平台切换。
- [x] 管理平台导航隔离（审计、系统设置、项目授权）。
- [x] 管理后台页面支持项目成员授权维护。
- [x] 新增用户角色管理接口与前端入口（管理后台可直接改角色）。

## 里程碑 M3：质量与安全加固（进行中）
- [ ] 在本地/测试环境完成 Prisma 正式迁移执行并回填历史数据。
- [ ] 增加高风险操作审计字段（旧值/新值/操作者/来源）。
- [ ] 为角色变更、授权变更、ReAct 写操作补自动化测试。
- [ ] 增加越权回归用例（跨项目读写、Chatbot 越权修改）。

## 里程碑 M4：多人协作上线准备（待开始）
- [ ] 按项目总监维度增加“可管理项目经理名单”策略（更细颗粒）。
- [ ] 增加管理平台首页（权限概览、异常操作告警、授权统计）。
- [ ] 产出运维手册：角色初始化、授权流程、审计排查 SOP。
- [ ] 制定物理分离路线（用户端/管理端独立部署）的技术方案。

## 发布步骤建议
1. 执行 Prisma 迁移并备份数据库。
2. 导入初始化授权关系（至少为每个项目补 owner 的 membership）。
3. 先灰度给一位项目总监和两位项目经理验证一周。
4. 观察审计日志和越权告警，再全量放开。
